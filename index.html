<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ã‰cran File dâ€™Attente - Premium</title>

<style>
html, body { margin:0; padding:0; height:100%; font-family:'Segoe UI', sans-serif; background:#000010; color:white; overflow:hidden; }

body.public-mode{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  position:relative;
}

/* =================== DATE & HEURE =================== */
#dateTime{
  position:absolute;
  top:20px;
  right:30px;
  text-align:right;
  line-height:1.2;
  font-weight:bold;
  color:#00ffff;
  text-shadow:0 0 8px #00ffff;
}

#time{ font-size:3vw; }
#day{ font-size:1.5vw; opacity:0.7; }

/* =================== NUMÃ‰RO CENTRAL =================== */
#centerZone{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  flex:1;
}

#publicNumber{
  font-size:20vw;
  color:#00ffff;
  text-shadow:
     0 0 10px #00ffff,
     0 0 20px #00ffff,
     0 0 40px #00ffff,
     0 0 80px #00ffff;
  font-weight:bold;
  transition:0.3s;
}

#status{
  font-size:4vw;
  margin-top:10px;
  color:white;
  text-shadow:0 0 6px cyan;
}

/* =================== HISTORIQUE =================== */
#lastCalls{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.5);
  padding:15px 25px;
  border-radius:15px;
  display:flex;
  gap:15px;
  flex-wrap:wrap;
  justify-content:center;
  font-size:1.8vw;
}

.callItem{
  background:rgba(255,255,255,0.05);
  padding:8px 16px;
  border-radius:10px;
}

/* =================== QR CODE =================== */
#qrCodeContainer{
  position:absolute;
  bottom:20px;
  left:20px;
  background:rgba(0,255,255,0.1);
  padding:10px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

#qrCodeContainer span{
  font-size:1vw;
  margin-top:5px;
  color:#00ffff;
}

/* =================== PLEIN Ã‰CRAN =================== */
#fullscreenBtn {
  position:absolute;
  bottom:20px;
  right:20px;
  padding:8px 12px;
  border:none;
  border-radius:8px;
  background:rgba(0,255,255,0.2);
  color:#00ffff;
  cursor:pointer;
  text-shadow:0 0 5px #00ffff;
  transition:0.2s;
}
#fullscreenBtn:hover { background:rgba(0,255,255,0.4); }
</style>
</head>

<body class="public-mode">

<div id="pub">
  <div id="dateTime"><div id="time">00:00:00</div><div id="day">...</div></div>

  <div id="centerZone">
    <div id="publicNumber">0</div>
    <div id="status">En attente...</div>
  </div>

  <div id="lastCalls"></div>

  <div id="qrCodeContainer">
    <canvas id="qrCode" width="120" height="120"></canvas>
    <span>Scannez pour suivre</span>
  </div>

  <button id="fullscreenBtn" onclick="document.documentElement.requestFullscreen()">Plein Ã©cran</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¹ Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAnaaDFSoR4TQeBT-GsePWh4NZ837zptcI",
  authDomain: "attente-a4b23.firebaseapp.com",
  projectId: "attente-a4b23",
  storageBucket: "attente-a4b23.firebasestorage.app",
  messagingSenderId: "305708504065",
  appId: "1:305708504065:web:10979176a13a4fb3829c00",
  measurementId: "G-QG0FXPWTG2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ðŸ”¹ Heure et date dynamique
function updateTime(){
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  document.getElementById('time').textContent = `${h}:${m}:${s}`;
  const options = {weekday:'long', day:'numeric', month:'long', year:'numeric'};
  document.getElementById('day').textContent = now.toLocaleDateString('fr-FR', options);
}
updateTime();
setInterval(updateTime,1000);

// ðŸ”¹ Firestore realtime
onSnapshot(doc(db,"queue","current"), (docSnap)=>{
  if(docSnap.exists()){
    const data=docSnap.data();
    document.getElementById("publicNumber").textContent = data.number;
    if(data.status==="absent"){
      document.getElementById("status").textContent="ABSENT";
      document.getElementById("status").style.color="gray";
    } else {
      document.getElementById("status").textContent = data.source;
      document.getElementById("status").style.color="white";
    }
    document.getElementById("lastCalls").innerHTML =
      data.lastCalls.map(c=>`<div class="callItem">#${c.number} â†’ ${c.source}</div>`).join("");
  }
});

// ðŸ”¹ QR Code
const script = document.createElement('script');
script.src = "https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js";
script.onload = () => {
  const canvas = document.getElementById('qrCode');
  QRCode.toCanvas(canvas, window.location.href, {width:120});
};
document.body.appendChild(script);
</script>
</body>
</html>
